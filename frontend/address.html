<!DOCTYPE html>
<html>
<head>
  <title>My Addresses</title>

  <style>
    body {
      font-family: Arial, sans-serif;
    }

    .container {
      width: 60%;
      margin: auto;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    button {
      margin-left: 8px;
      cursor: pointer;
    }

    input {
      width: 100%;
      padding: 6px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<div id="navbar"></div>

<script>
  fetch("navbar.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("navbar").innerHTML = html;
      renderNavbar();
    });
</script>
<script src="navbar.js"></script>

<div class="container">

  <h2>Saved Addresses</h2>

  <!-- Address list -->
  <ul id="addressList"></ul>

  <hr>

  <h3>Add New Address</h3>

  <input id="addrLabel" placeholder="Label (Home / Office)">
  <input id="addrLine1" placeholder="Address line">
  <input id="addrLocation" placeholder="Location">
  <input id="addrPincode" placeholder="Pincode">

  <button id="saveBtn" onclick="saveAddress()">Save Address</button>


</div>

<script src="app.js"></script>

<script>
  let editingAddressId = null;

  // Protect page: admin not allowed
  if (getUserRole() === "admin") {
    alert("Admins cannot manage addresses");
    window.location.href = "admin.html";
  }

  // Load all user addresses (no location filter here)
  function loadAddressesList() {
    fetch(`${API_BASE}/auth/addresses`, {
      headers: {
        Authorization: `Bearer ${localStorage.getItem("jwt")}`
      }
    })
    .then(res => res.json())
    .then(addresses => {
      const ul = document.getElementById("addressList");
      ul.innerHTML = "";

      addresses.forEach(a => {
        const li = document.createElement("li");
        li.innerHTML = `
  <div>
    <b>${a.label}</b><br>
    ${a.line1}<br>
    ${a.location} - ${a.pincode}
  </div>
  <div>
    <button onclick="editAddress('${a.addressId}')">Edit</button>
    <button onclick="deleteAddress('${a.addressId}')">Delete</button>
  </div>
`;

        ul.appendChild(li);
      });
    });
  }

  function startEditAddress(id, label, line1, location, pincode) {
  editingAddressId = id;

  document.getElementById("addrLabel").value = label;
  document.getElementById("addrLine1").value = line1;
  document.getElementById("addrLocation").value = location;
  document.getElementById("addrPincode").value = pincode;

  document.getElementById("saveBtn").innerText = "Update Address";
}
function deleteAddress(id) {
  if (!confirm("Delete this address?")) return;

  fetch(`${API_BASE}/auth/addresses/${id}`, {
    method: "DELETE",
    headers: {
      Authorization: `Bearer ${localStorage.getItem("jwt")}`
    }
  })
  .then(() => loadAddressesList());
}

function editAddress(id) {
  const label = prompt("Label:");
  const line1 = prompt("Address line:");
  const location = prompt("Location:");
  const pincode = prompt("Pincode:");

  if (!label || !line1 || !location) {
    alert("All fields required");
    return;
  }

  fetch(`${API_BASE}/auth/addresses/${id}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${localStorage.getItem("jwt")}`
    },
    body: JSON.stringify({ label, line1, location, pincode })
  })
  .then(() => loadAddressesList());
}

  function deleteAddress(id) {
    if (!confirm("Delete this address?")) return;

    fetch(`${API_BASE}/auth/addresses/${id}`, {
      method: "DELETE",
      headers: {
        Authorization: `Bearer ${localStorage.getItem("jwt")}`
      }
    })
    .then(() => loadAddressesList());
  }

  loadAddressesList();
</script>

</body>
</html>
